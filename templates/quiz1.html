{% extends "layout.html" %} {% block content %}

<div class="container">
    <div class="progress">
        <div class="progress-bar" role="progressbar" aria-valuenow="{{question.progress[0]}}" aria-valuemin="0" aria-valuemax="100" style="width: {{question.progress[0]}}%"></div>
      </div>
      
      <div class="row">
        <div class="col-md-3">
            <div>{{ question.question }} </div>
        </div>
        <div class="row">
          <div class="col-md-4">
              <img class="img_format" src={{question.image}}>
          </div>
      </div>
      
        <div class="col-md-3 ">
            {% for each in question.options %}
            <div class="row questionOptions">
              <button type="button" class="btn btn-warning">
                <div class="options">{{each[0]}}</div>
                <img src="{{each[1]}}">
              </button>
            </div>
            {% endfor %}
        </div>
      </div>
      <div class="row" id="feedback"></div>
      
      <div class="row">
        <div class="col-md-2">
          <button type="button" class="btn btn-primary" id="checkBtn" disabled>
            Submit
          </button>
        </div>
        <div>
          <div class = "btn btn-dark" id = "previous-btn"> Previous </div>
          <div class = "btn btn-dark" id = "next-btn"> Next </div>
      </div>
</div>
</div>


<script>

let question = {{question|tojson}};
let optionCorrect = false;
let wrongAnswer=0;

function chooseAnswer(element){
    $("#checkBtn").prop("disabled", false);
    if ($(element).find(".options").html() == question["answer"]) {
        optionCorrect = true;
    } else {
        optionCorrect = false;
    }
}

function checkAnswer() {
    $("#feedback").empty();
    if (optionCorrect == true) {
        $("#feedback").text("Correct!")
        $('.progress-bar').css('width', question.progress[1]+'%').attr('aria-valuenow', question.progress[1]);    
        return
    } else {
        wrongAnswer += 1;
  }

  $.ajax({
      type: "POST",
      url: "/wrong_ans",
      dataType : "json",
      contentType: "application/json; charset=utf-8",
      data: JSON.stringify(wrongAnswer),
      success: function (response) {
          $("#feedback").text(question.answer + " is the correct answer.");
          $('.progress-bar').css('width', question.progress[1]+'%').attr(question.progress[1]);    
      },
      error: function(request, status, error){
      }
  });
}

$(document).ready(function () {
    $("#previous-btn").click(function(){
        id = parseInt({{question.quiz_id}});
        id -= 1;
        if(id > 0){
            id = id - 1
            window.location.href = "/quiz1/" + id;
            console.log(id)
        }
        else{
            window.location.href = "/quiz1/0"
        }
    });
        $("#next-btn").click(function(){
            id = parseInt({{question.quiz_id}});
            if(id < 3){
                window.location.href = "/quiz1/" + id;
            }
            else
            {
                window.location.href = "/";
            }
            id += 1;
        })
    $(".questionOptions").each(function (index, element) {
        $(element).click(function(){chooseAnswer($(element))});
    });

    $("#checkBtn").click(checkAnswer);
})

</script>

{% endblock %}
